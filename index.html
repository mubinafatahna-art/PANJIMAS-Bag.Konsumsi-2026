<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMA-Monitoring Anggaran</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
    /* Tambahkan ini di dalam tag <style> */
    @media (max-width: 768px) {
        .card-stat h4 {
            font-size: 1.5rem; /* Ukuran angka lebih besar di HP */
        }
        .container-fluid {
            padding: 10px !important;
        }
    }
        :root { --primary: #0d6efd; --success: #198754; --warning: #ffc107; }
        body { background-color: #f8f9fa; font-size: 0.85rem; }
        .card-stat { border: none; border-radius: 12px; color: white; transition: 0.3s; }
        .bg-gradient-blue { background: linear-gradient(45deg, #0d6efd, #00d4ff); }
        .bg-gradient-red { background: linear-gradient(45deg, #f53844, #fe4f70); }
        .bg-gradient-green { background: linear-gradient(45deg, #11998e, #38ef7d); }
        .table thead { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; }
    </style>
</head>
<body class="p-2 p-md-4">

<div class="container-fluid">
    <h2 class="text-center fw-bold mb-4">
        <br>
            <span style="font-size: 1.5rem; font-weight: normal;">SISTEM MONITORING ANGGARAN (SMA)</span>
    </h2>
    <h3 class="text-center fw-bold mb-4">BAGIAN KONSUMSI PANJIMAS 2026</h3>
    <div class="row g-2 mb-4">
    <div class="col-12 col-md-4">
        <div class="card card-stat bg-gradient-blue p-3 shadow-sm text-center">
            <small>Total Anggaran</small>
            <h4 id="at" class="fw-bold mb-0">Rp 180.000.000</h4>
        </div>
    </div>
    
    <div class="col-12 col-md-4">
        <div class="card card-stat bg-gradient-red p-3 shadow-sm text-center">
            <small>Dana Terpakai</small>
            <h4 id="dt" class="fw-bold mb-0">Rp 0</h4>
        </div>
    </div>
    
    <div class="col-12 col-md-4">
        <div class="card card-stat bg-gradient-green p-3 shadow-sm text-center">
            <small>Sisa Anggaran</small>
            <h4 id="sa" class="fw-bold mb-0">Rp 180.000.000</h4>
        </div>
    </div>
</div>

    <div class="row g-3">
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm p-3 rounded-3">
                <h6 class="fw-bold mb-3 border-bottom pb-2">INPUT DATA BARU</h6>
                <form id="f">
                    <div class="mb-2">
                        <label class="x-small fw-bold">No. Pesanan</label>
                        <input type="text" id="n1" class="form-control form-control-sm" placeholder="Contoh: 001" required>
                    </div>
                    <div class="mb-2">
                        <label class="x-small fw-bold">Tanggal Pesan</label>
                        <input type="date" id="n2" class="form-control form-control-sm" required>
                    </div>
                    <div class="mb-2">
                        <label class="x-small fw-bold">Nama Anggota</label>
                        <select id="n3" class="form-control form-control-sm" required>
                            <option value="" disabled selected>Pilih Anggota...</option>
                            <option value="Fatahna">Fatahna</option>
                            <option value="Aghea">Aghea</option>
                            <option value="Syauqi">Syauqi</option>
                            <option value="Abdillah">Abdillah</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="x-small fw-bold">Item/Menu</label>
                        <input type="text" id="n4" class="form-control form-control-sm" placeholder="Contoh: Snack Pagi" required>
                    </div>
                    <div class="mb-2">
                        <label class="x-small fw-bold">Nominal (Rp)</label>
                        <input type="number" id="n5" class="form-control form-control-sm" placeholder="Hanya angka" required>
                    </div>
                    <div class="mb-3">
                        <label class="x-small fw-bold">Upload Nota</label>
                        <input type="file" id="n6" class="form-control form-control-sm" accept="image/*" required>
                    </div>
                    <button type="submit" id="btn" class="btn btn-primary btn-sm w-100 fw-bold shadow-sm">KIRIM DATA</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
                <div class="bg-dark p-2"><h6 class="text-white mb-0 text-center">UPDATE PENGGUNAAN DANA</h6></div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0" style="font-size: 0.8rem;">
                        <thead class="table-light">
                            <tr>
                                <th>No</th>
                                <th>No. Pesanan</th>
                                <th>Nama</th>
                                <th>Item</th>
                                <th>Nominal</th>
                                <th>Status</th>
                                <th>Nota</th>
                            </tr>
                        </thead>
                        <tbody id="tb">
                            <tr><td colspan="7" class="text-center py-4">Menghubungkan ke database...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwJDAsjqhJ35uv0ImgJPpIrT4JQVjVRC40DlacdOI2S-oB9142_gwkHAp4SnB8f6NTC/exec"; 
    const BUDGET_AWAL = 180000000;

    function loadData() {
        fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                let html = "";
                let terpakai = 0;
                if (data && data.length > 1) {
                    for(let i = 1; i < data.length; i++) {
                        const nominal = Number(data[i][5]) || 0;
                        terpakai += nominal;
                        
                        // Logika Status Valid (Jika ada link Drive)
                        const linkNota = data[i][6];
                        const isValid = (linkNota && linkNota.includes("drive.google.com"));
                        const statusBadge = isValid 
                            ? '<span class="badge bg-success" style="font-size: 0.7rem;">âœ“ Valid</span>' 
                            : '<span class="badge bg-warning text-dark" style="font-size: 0.7rem;">Pending</span>';

                        html += `<tr>
                            <td>${i}</td>
                            <td class="fw-bold">${data[i][1]}</td>
                            <td>${data[i][3]}</td>
                            <td>${data[i][4]}</td>
                            <td class="text-primary fw-bold">Rp ${nominal.toLocaleString('id-ID')}</td>
                            <td>${statusBadge}</td>
                            <td><a href="${linkNota}" target="_blank" class="btn btn-xs btn-outline-primary py-0 px-2 ${isValid ? '' : 'disabled'}" style="font-size: 0.7rem;">Lihat</a></td>
                        </tr>`;
                    }
                    document.getElementById('tb').innerHTML = html;
                    document.getElementById('at').innerText = "Rp " + BUDGET_AWAL.toLocaleString('id-ID');
                    document.getElementById('dt').innerText = "Rp " + terpakai.toLocaleString('id-ID');
                    document.getElementById('sa').innerText = "Rp " + (BUDGET_AWAL - terpakai).toLocaleString('id-ID');
                }
            });
    }

    document.getElementById('f').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btn');
        btn.disabled = true;
        btn.innerText = "SEDANG MENGUPLOAD...";

        const reader = new FileReader();
        reader.onload = function() {
            const body = {
                noPesanan: document.getElementById('n1').value,
                tglPesan: document.getElementById('n2').value,
                nama: document.getElementById('n3').value,
                keperluan: document.getElementById('n4').value,
                nominal: document.getElementById('n5').value,
                imageBlob: reader.result
            };

            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(body) })
            .then(() => {
                alert('DATA BERHASIL DISIMPAN!');
                location.reload();
            })
            .catch(() => {
                alert('Gagal mengirim data.');
                btn.disabled = false;
                btn.innerText = "KIRIM DATA";
            });
        };
        reader.readAsDataURL(document.getElementById('n6').files[0]);
    };

    loadData();
</script>

</body>
</html>
